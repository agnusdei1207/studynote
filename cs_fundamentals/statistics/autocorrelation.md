# 자기상관 (Autocorrelation)

## 1. 개념 및 정의

### 1.1 기본 정의
자기상관(Autocorrelation)은 **하나의 시계열 데이터 내에서 서로 다른 시점 간의 상관관계**를 측정하는 통계적 방법입니다. 시차(Lag)에 따른 자기상신호와의 유사성을 정량적으로 분석하여, 시계열의 패턴, 주기성, 추세 등을 파악합니다.

### 1.2 수학적 정의
자기상관은 시계열 데이터 $X_t$에서 $t$ 시점과 $t+k$ 시점 사이의 선형 상관관계를 나타냅니다. 여기서 $k$를 시차(Lag)라 하며, $k=0$일 때 자기상관계수는 항상 1입니다.

$$ \rho_k = \frac{\gamma_k}{\gamma_0} $$

여기서:
- $\rho_k$: 시차 $k$에서의 자기상관계수 (Autocorrelation Coefficient)
- $\gamma_k$: 시차 $k$에서의 자기공분산 (Autocovariance)
- $\gamma_0$: 분산 (Variance)

### 1.3 자기상관함수 (Autocorrelation Function, ACF)
자기상관함수는 시차 $k$의 함수로서 자기상관계수의 집합을 의미합니다. 모든 시차 $k$에 대한 자기상관계수를 계산하여 시계열의 구조적 특성을 분석합니다.

$$ ACF(k) = \frac{\sum_{t=1}^{n-k}(X_t - \bar{X})(X_{t+k} - \bar{X})}{\sum_{t=1}^{n}(X_t - \bar{X})^2} $$

## 2. 등장 배경 및 역사

### 2.1 역사적 배경

| 시기 | 주요 인물 | 기여 내용 |
|------|-----------|-----------|
| 1920년대 | George Udny Yule | 자기상관의 개념 제시, 시계열 분석 기초 마련 |
| 1927년 | Gwilym Jenkins | ARIMA 모형 개발에 자기상관 활용 |
| 1970년 | George Box & Gwilym Jenkins | 시계열 분석의 체계적 접근법 정립 (Box-Jenkins 모형) |
| 1990년대 이후 | Clive Granger | 공적분(Cointegration) 연구에 자기상관 응용, 노벨상 수상 |

### 2.2 개발 동기
- **시계열 데이터의 예측**: 과거 데이터 패턴을 활용한 미래 예측 필요성
- **신호 처리**: 음성, 통신 신호에서 주기성 분석 요구
- **품질 관리**: 공정 데이터의 패턴 식별 및 이상 탐지
- **경제 분석**: 경제 시계열의 자기회귀 현상 이해

### 2.3 기술적 발전
1. 초기: 도구적 계산에 의한 수동 계산
2. 중기: 컴퓨터 발전으로 대량 데이터 처리 가능
3. 최근: 실시간 스트리밍 데이터의 온라인 자기상관 계산
4. 미래: 딥러닝과 결합한 비선형 자기상관 분석

## 3. 구성 요소

### 3.1 시차 (Lag)
시차는 자기상관을 측정할 때 두 데이터 포인트 사이의 시간 간격입니다.

$$ \text{Lag } k = t_2 - t_1 $$

- **Lag 0**: 동일 시점 (상관계수 = 1)
- **Lag 1**: 직전 시점과의 상관관계
- **Lag k**: $k$ 시점 전과의 상관관계

### 3.2 자기공분산 (Autocovariance)
시차 $k$에 대한 공분산을 의미합니다.

$$ \gamma_k = E[(X_t - \mu)(X_{t+k} - \mu)] $$

여기서 $\mu$는 시계열의 평균입니다.

### 3.3 자기상관계수 (Autocorrelation Coefficient)
자기공분산을 표준화하여 -1에서 1 사이의 값을 가집니다.

$$ \rho_k = \frac{\gamma_k}{\sigma^2} = \frac{E[(X_t - \mu)(X_{t+k} - \mu)]}{\sigma^2} $$

### 3.4 편자기상관함수 (Partial Autocorrelation Function, PACF)
다른 시차의 영향을 통제한 순수한 자기상관을 나타냅니다. ARIMA 모형 식별에 필수적입니다.

$$ \phi_{kk} = \text{Corr}(X_t, X_{t+k} \mid X_{t+1}, \ldots, X_{t+k-1}) $$

### 3.5 자기상관의 종류

| 종류 | 설명 | 특징 |
|------|------|------|
| 양의 자기상관 | 이전 값이 높으면 다음 값도 높음 | $0 < \rho_k \leq 1$ |
| 음의 자기상관 | 이전 값이 높으면 다음 값이 낮음 | $-1 \leq \rho_k < 0$ |
| 무상관 (White Noise) | 시차에 따른 상관관계 없음 | $\rho_k = 0$ |

## 4. 핵심 원리

### 4.1 자기상관계수 계산 알고리즘

#### 표본 자기상관계수 (Sample Autocorrelation)
$$ \hat{\rho}_k = \frac{\sum_{t=1}^{n-k}(X_t - \bar{X})(X_{t+k} - \bar{X})}{\sum_{t=1}^{n}(X_t - \bar{X})^2} $$

**계산 절차**:
1. 시계열 데이터 $X_1, X_2, \ldots, X_n$에 대한 평균 $\bar{X}$ 계산
2. 각 시차 $k$에 대해 편차 곱의 합 $\sum (X_t - \bar{X})(X_{t+k} - \bar{X})$ 계산
3. 전체 분산으로 나누어 정규화
4. -1 ≤ $\hat{\rho}_k$ ≤ 1 범위 확인

### 4.2 정상성 (Stationarity) 가정

자기상관은 **약 정상성(Weak Stationarity)** 가정 하에서 유효합니다.

$$ E[X_t] = \mu \quad (\text{상수}) $$
$$ \text{Var}(X_t) = \sigma^2 \quad (\text{상수}) $$
$$ \text{Cov}(X_t, X_{t+k}) = \gamma_k \quad (\text{시차 } k \text{에만 의존}) $$

### 4.3 자기상관의 통계적 검정

#### 뤼뉭-복스(Ljung-Box) 검정
자기상관의 유의성을 검정합니다.

$$ Q = n(n+2)\sum_{k=1}^{m}\frac{\hat{\rho}_k^2}{n-k} $$

- $H_0$: 모든 자기상관계수가 0 (백색 잡음)
- $H_1$: 적어도 하나의 자기상관계수가 0이 아님
- 검정통계량 $Q$는 카이제곱 분포 $\chi^2(m)$ 따름

#### 드빈-왓슨(Durbin-Watson) 검정
회귀분석의 잔차 자기상관 검정에 사용됩니다.

$$ DW = \frac{\sum_{t=2}^{n}(e_t - e_{t-1})^2}{\sum_{t=1}^{n}e_t^2} $$

- $DW \approx 2$: 자기상관 없음
- $DW \approx 0$: 강한 양의 자기상관
- $DW \approx 4$: 강한 음의 자기상관

### 4.4 자기상관의 그래프적 해석

```
ACF 그래프 해석
       ρ_k
  1.0 |        ●
       |        ●
  0.5 |        ●●
       |        ●●
  0.0 |--------●●--------
       |        ●●
 -0.5 |        ●●
       |        ●
 -1.0 |
       +----+----+----+-> k
        0    1    2    3
```

- **지수적 감소**: AR(AutoRegressive) 모형 특성
- **절단형**: MA(Moving Average) 모형 특성
- **사인파 형태**: 계절성(Seasonality) 존재

## 5. 장단점 분석

### 5.1 장점

| 장점 | 설명 | 실무적 활용 |
|------|------|-------------|
| **패턴 식별** | 시계열의 반복 패턴 명확화 | 주기성, 추세 탐지 |
| **모형 식별** | ARIMA 모형의 차수 결정 | 적절한 모형 선택 |
| **예측 성능** | 과거 데이터 기반 미래 예측 | 수요 예측, 주가 예측 |
| **이상 탐지** | 자기상관 급변 시 이상 신호 | 공정 모니터링 |
| **해석 용이성** | 직관적인 그래프 해석 | 비전문가도 이해 가능 |

### 5.2 단점

| 단점 | 설명 | 해결 방안 |
|------|------|-----------|
| **정상성 의존** | 비정상 시계열에서는 왜곡됨 | 차분(Differencing) 적용 |
| **선형 제한** | 비선형 관계 포착 불가 | 비선형 모형(ANN, LSTM) 병행 |
| **노이즈 민감** | 잡음에 의한 가성 자기상관 | 필터링 전처리 |
| **시차 선택** | 적절한 시차 결정 어려움 | PACF, 정보기준(AIC/BIC) 활용 |
| **데이터 요구** | 충분한 데이터 필요 | 보간법, Bootstrapping 고려 |

### 5.3 실무적 고려사항

1. **데이터 길이**: 최소 50개 이상의 데이터 포인트 권장
2. **결측치 처리**: 결측치가 있는 경우 자기상관 과대/과소 추정 위험
3. **계절성**: 계절성이 강한 경우 계절 차분 후 분석 필요
4. **다중공선성**: 시차 간 자기상관이 높은 경우 회귀분석 문제

## 6. 다른 개념과의 비교

### 6.1 상관계수 (Correlation Coefficient) vs 자기상관

| 비교 항목 | 상관계수 | 자기상관 |
|-----------|----------|----------|
| **대상** | 두 다른 변수 간의 관계 | 동일 변수의 서로 다른 시점 간 관계 |
| **시간 고려** | 시간 독립적 | 시차(Lag) 개념 핵심 |
| **차원** | $n \times p$ 행렬 | 1차원 시계열 |
| **적용 예시** | 온도-습도 관계 | 오늘 온도-내일 온도 관계 |
| **계산식** | $\rho_{XY} = \frac{Cov(X,Y)}{\sigma_X \sigma_Y}$ | $\rho_k = \frac{Cov(X_t, X_{t+k})}{Var(X_t)}$ |

### 6.2 교차상관 (Cross-Correlation)

**정의**: 두 다른 시계열 간의 시차에 따른 상관관계

$$ \rho_{XY}(k) = \frac{E[(X_t - \mu_X)(Y_{t+k} - \mu_Y)]}{\sigma_X \sigma_Y} $$

**비교**:
- 교차상관: X와 Y 두 시계열 간의 인과관계 분석
- 자기상관: 하나의 시계열 내 자기 반복 패턴 분석

### 6.3 공분산 (Covariance) vs 자기상관

| 비교 항목 | 공분산 | 자기상관 |
|-----------|--------|----------|
| **척도** | 원래 데이터 단위 | 정규화된 값 (-1 ~ 1) |
| **해석** | 직관적 해석 어려움 | 표준화로 비교 용이 |
| **데이터 의존** | 단위에 따라 값 변화 | 단위 무관한 상대적 척도 |

### 6.4 다른 시계열 분석 기법과의 관계

```
시계열 분석 기법 계층도
┌─────────────────────────────────────┐
│      시계열 분석 (Time Series)      │
└─────────────────────────────────────┘
                    ↓
┌──────────────┬──────────────┬──────────────┐
│  추세 분석   │  계절성 분석 │  자기상관   │
│   (Trend)    │ (Seasonality)│(Autocorr.)  │
└──────────────┴──────────────┴──────────────┘
                    ↓
┌─────────────────────────────────────┐
│        ARIMA / SARIMA 모형         │
│  (자기상관 기반 시계열 예측 모형)   │
└─────────────────────────────────────┘
```

## 7. 기술사적 판단 및 실무 적용

### 7.1 기술사적 판단 체크리스트

| 판단 항목 | 검토 내용 | 기준 |
|-----------|-----------|------|
| **데이터 적합성** | 정상성 확인 여부 | 차분 또는 로그변환 필요성 |
| **시차 선택** | 최적 시차 결정 | PACF, AIC/BIC 기준 |
| **유의성 검정** | 자기상관 통계적 유의성 | Ljung-Box p-value < 0.05 |
| **모형 적합** | 잔차의 백색 잡음 여부 | 잔차 자기상관 없어야 함 |
| **예측 성능** | MAE, RMSE, MAPE 등 | 비교 모형 대비 우수성 확인 |

### 7.2 실무 적용 절차

#### 단계 1: 데이터 전처리
1. 결측치 처리 (보간법, 평균 대체 등)
2. 이상치 탐지 및 처리 (IQR, Z-score 기준)
3. 정상성 검정 (ADF 검정, KPSS 검정)
4. 필요 시 차분 또는 변환

#### 단계 2: 탐색적 데이터 분석 (EDA)
1. 시계열 시각화 (Trend, Seasonality 확인)
2. ACF, PACF 그래프 작성
3. 자기상관 패턴 식별

#### 단계 3: 모형 식별 및 추정
1. ACF 지연 감소 → AR(p) 모형
2. PACF 절단 → MA(q) 모형
3. ARIMA(p, d, q) 차수 결정

#### 단계 4: 모형 진단
1. 잔차의 자기상관 검정
2. 정규성 검정
3. 예측 성능 평가

### 7.3 실무 적용 사례

#### 사례 1: 통신 트래픽 예측
- **목적**: 네트워크 대역폭 최적화
- **적용**: 트래픽 데이터의 시간적 자기상관 분석
- **결과**: ARIMA 모형으로 95% 정확도 예측 달성
- **기술사적 고려**: 이벤트 기반 비정상성 처리 필요

#### 사례 2: 제조 공정 품질 관리
- **목적**: 공정 이상 조기 탐지
- **적용**: 센서 데이터 자기상관 모니터링
- **결과**: 자기상관 급변 시점에서 97% 이상 이상 탐지
- **기술사적 고려**: 실시간 처리를 위한 윈도우 기반 자기상관 계산

#### 사례 3: 금융 시계열 분석
- **목적**: 주가 변동 패턴 분석
- **적용**: 수익률 시계열의 자기상관 분석
- **결과**: 단기 자기상관은 있으나 장기 무상관 확인
- **기술사적 고려**: 휴일, 급락 이벤트 처리

### 7.4 성능 최적화 방안

1. **계산 복잡도 개선**:
   - FFT(Fast Fourier Transform) 활용: $O(n \log n)$
   - 대역 제한(Band-limited) 자기상관

2. **실시간 처리**:
   - 슬라이딩 윈도우 기반 온라인 계산
   - 증분 알고리즘 적용

3. **메모리 최적화**:
   - 순환 버퍼(Ring Buffer) 활용
   - 필요 시차만 선택적 저장

## 8. 미래 전망 및 응용 분야

### 8.1 기술 동향

| 기술 | 설명 | 영향 |
|------|------|------|
| **딥러닝 융합** | LSTM, Transformer 등 딥러닝과 자기상관 결합 | 비선형 패턴 정확도 향상 |
| **고빈도 데이터** | 실시간 IoT 센서 데이터 처리 | 엣지 컴퓨팅 기반 자기상관 |
| **멀티모달 분석** | 텍스트, 이미지, 시계열 통합 | 크로스-모달 자기상관 |
| **설명 가능 AI** | 자기상관 기반 시계열 해석 | 모형 투명성 확보 |

### 8.2 응용 분야 확장

#### 1. 스마트 시티
- **교통 흐름**: 자기상관 기반 혼잡 예측
- **에너지 그리드**: 전력 수요 패턴 분석
- **환경 모니터링**: 대기질 시계열 이상 탐지

#### 2. 헬스케어
- **의료 시그널**: ECG, EEG 패턴 분석
- **바이오마커**: 혈압, 혈당 자기상관 기반 예측
- **전염병**: COVID-19 등 확산 패턴 분석

#### 3. 금융 테크
- **알고리즘 트레이딩**: 고빈도 주가 자기상관 활용
- **리스크 관리**: 포트폴리오 자산 수익률 자기상관
- **사기 탐지**: 비정상 금융 거래 패턴

#### 4. 제조 4.0
- **예지 보전(Predictive Maintenance)**: 설비 센서 자기상관 기반 고장 예측
- **품질 최적화**: 공정 파라미터 자기상관 분석
- **에너지 효율**: 공장 에너지 소비 패턴

### 8.3 미래 과제

1. **비선형 자기상관**: 기존 선형 자기상관의 한계 극복
2. **다변량 자기상관**: 여러 변수 간 동적 상관관계
3. **스케일 불변 자기상관**: 다양한 시간 스케일에서의 패턴
4. **온라인 학습**: 스트리밍 데이터 실시간 적응
5. **인터프리터빌리티**: 복잡한 자기상관 패턴 설명 가능성

### 8.4 기술사적 전략 제언

- **표준화**: 자기상관 분석 표준 프로세스 수립
- **자동화**: 머신러닝 파이프라인에 자기상관 모듈 통합
- **검증**: 교차검증(Validation) 및 백테스팅 강화
- **모니터링**: 모형 성능 모니터링 및 재학습 전략
- **보안**: 자기상관 기반 이상 탐지 시스템 보안 강화

---

## 부록: 어린이를 위한 자기상관 이해하기

### 쉬운 설명

자기상관은 **"어제 한 일과 오늘 한 일이 얼마나 비슷한지?"**를 알아보는 방법이에요.

예를 들어보면:
- 어제 공부를 열심히 했으면, 오늘도 열심히 할까요?
- 어제 많이 웃었으면, 오늘도 많이 웃을까요?

이렇게 **"내 과거와 현재가 얼마나 비슷한지"**를 숫자로 나타내는 게 자기상관이에요!

- 숫자가 **1**에 가까우면: 어제와 오늘이 아주 비슷해요
- 숫자가 **0**이면: 어제와 오늘이 전혀 관계가 없어요
- 숫자가 **-1**에 가까우면: 어제와 오늘이 정반대예요

### 비유와 예시

#### 비유 1: 날씨와 옷차림
- **자기상관이 높은 경우**:
  - 어제가 추웠으면, 오늘도 추울 확률이 높아요 → 두꺼운 옷 계속 입어요
  - 이것이 **"양의 자기상관"**이에요 (비슷한 패턴 반복)

- **자기상관이 낮은 경우**:
  - 어제 날씨와 오늘 날씨가 완전 달라요 → 옷차림 예측이 어려워요

#### 비유 2: 책 읽기 습관
- **하루 30분씩 매일 책을 읽는 친구**:
  - 어제 읽었으면 오늘도 읽어요 → 자기상관이 높아요!

- **가끔 읽는 친구**:
  - 어제 읽었어도 오늘 안 읽을 수도 있어요 → 자기상관이 낮아요

#### 비유 3: 시간(TIME) 그림 그리기
```
자기상관은 "과거와 미래의 인사"를 하는 것과 같아요!

과거(Past)        현재(Present)        미래(Future)
    ● ────────●───────────────●
    
인사(자기상관) 👋
    ↑
"과거의 나"가 "현재의 나"에게 말을 걸어요

- 인사가 자주 일어나면 = 자기상관이 높아요
- 인사가 드물면 = 자기상관이 낮아요
```

#### 재미있는 실험
자기상관을 직접 확인해 볼까요?

1. **자기 기록표 만들기**:
   - 월요일부터 금요일까지 운동 시간 기록
   - "어제 운동 시간"과 "오늘 운동 시간" 비교

2. **패턴 찾기**:
   - 어래 많이 했으면 오늘도 많이 했나요?
   - 아니면 어제와 오늘이 다른가요?

3. **숫자로 표현**:
   - 비슷하면 "자기상관이 높다!"
   - 다르면 "자기상관이 낮다!"

#### 왜 자기상관이 중요할까요?

- **날씨 예보**: 지난주 날씨를 보고 오늘 날씨 예측
- **주식 투자**: 지난 주가를 보고 오늘 주가 예측
- **교통 예측**: 어제 교통량을 보고 오늘 혼잡 예측

모두 자기상관을 이용해 **"과거의 패턴으로 미래를 예측"**하는 거예요!

#### 기억할 키워드 📝
- **자기상관**: 과거와 현재의 관계 (나와 나의 관계)
- **시차(Lag)**: 얼마나 떨어진 시점인지 (1일 전, 7일 전)
- **양의 자기상관**: 비슷한 패턴 반복 (어래 했으면 오늘도 해)
- **음의 자기상관**: 반대 패턴 (어래 했으면 오늘은 안 해)
- **무상관**: 아무 관계 없음 (어제와 오늘은 별개)
