{% extends "base.html" %}

{% block content %}
<section class="recent-posts">
    <div class="post-feed">
        {%- set dl = get_section(path="cs_fundamentals/digital_logic/_index.md") -%}
        {%- set nw = get_section(path="cs_fundamentals/network/_index.md") -%}
        {%- set os = get_section(path="cs_fundamentals/operating_system/_index.md") -%}
        {%- set ca = get_section(path="cs_fundamentals/computer_architecture/_index.md") -%}
        {%- set dc = get_section(path="cs_fundamentals/data_communication/_index.md") -%}
        {%- set rust = get_section(path="programming/rust/_index.md") -%}
        {%- set devops = get_section(path="devops/_index.md") -%}
        {%- set all_pages = dl.pages | concat(with=nw.pages) | concat(with=os.pages) | concat(with=ca.pages) |
        concat(with=dc.pages) | concat(with=rust.pages) | concat(with=devops.pages) -%}
        {%- set sorted = all_pages | sort(attribute="date") | reverse -%}
        {% for page in sorted | slice(end=3) %}
        <div class="post-card-wrapper">
            <a class="post-card" href="{{ page.permalink }}">
                <div class="pc-meta">
                    <span class="pc-avatar">{{ page.title | truncate(length=1, end="") }}</span>
                    <span>{{ page.date | date(format="%Y.%m.%d") }}</span>
                    {% if page.extra.categories %}
                    <span style="opacity:0.4">Â·</span>
                    <span>{{ page.extra.categories | replace(from="-", to=" ") }}</span>
                    {% endif %}
                </div>
                <div class="pc-title">{{ page.title }}</div>
                {% if page.summary %}
                <div class="pc-excerpt">{{ page.summary | safe | striptags | truncate(length=100) }}</div>
                {% endif %}
            </a>
            <button class="card-copy-btn" data-url="{{ page.permalink }}" title="Copy content">
                {% include "icons/copy.html" %}
                {% include "icons/check.html" %}
            </button>
        </div>
        {% endfor %}
    </div>
</section>

<script>
    document.querySelectorAll('.card-copy-btn').forEach(function (btn) {
        btn.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            var url = btn.dataset.url;
            fetch(url)
                .then(function (r) { return r.text(); })
                .then(function (html) {
                    var doc = new DOMParser().parseFromString(html, 'text/html');
                    var content = doc.querySelector('.post-content');
                    if (content) {
                        navigator.clipboard.writeText(content.innerText || content.textContent).then(function () {
                            btn.classList.add('copied');
                            setTimeout(function () { btn.classList.remove('copied'); }, 2000);
                        });
                    }
                });
        });
    });
</script>
{% endblock content %}