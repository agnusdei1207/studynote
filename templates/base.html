<!DOCTYPE html>
<html lang="ko-KR" data-theme="dark">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{% if page.title %}{{ page.title }} — {{ config.title }}{% elif section.title %}{{
        section.title }} — {{ config.title }}{% else %}{{ config.title }}{% endif %}{% endblock title %}</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="{{ get_url(path='assets/css/style.css') }}">
    <link rel="icon" type="image/svg+xml" href="https://api.iconify.design/lucide:brain-circuit.svg?color=%2310b981">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false}]})"></script>

    <script>
        (function () {
            var t = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', t);
        }());
    </script>
</head>

<body>

    <header class="site-header">
        <div class="header-inner">
            <a href="{{ get_url(path='/') }}" class="site-logo"><img
                    src="https://api.iconify.design/lucide:brain-circuit.svg?color=%2310b981" width="26" height="26"
                    alt=""
                    style="vertical-align:middle;margin-right:8px;position:relative;top:-1px;">Brain<span>Science</span></a>

            <div class="header-search" id="header-search-wrap">
                {% include "icons/search.html" %}
                <input type="text" id="pagefind-search" placeholder="Search anything..." autocomplete="off">
                <div id="pagefind-dropdown"></div>
            </div>

            <div class="header-actions">
                <a href="https://github.com/{{ config.extra.github_username }}" target="_blank" rel="noopener"
                    title="GitHub">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" />
                    </svg>
                </a>
                <button id="theme-btn" title="Toggle theme">
                    {% include "icons/sun.html" %}
                    {% include "icons/moon.html" %}
                </button>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            {% block content %}{% endblock content %}
        </div>
    </main>

    <script>
        /* Theme */
        var tBtn = document.getElementById('theme-btn'), iS = document.getElementById('i-sun'), iM = document.getElementById('i-moon');
        function apply(t) {
            document.documentElement.setAttribute('data-theme', t);
            iS.style.display = t === 'dark' ? 'none' : ''; iM.style.display = t === 'dark' ? '' : 'none';
        }
        apply(document.documentElement.getAttribute('data-theme') || 'light');
        tBtn.onclick = function () {
            var n = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', n); apply(n);
        };

        /* Pagefind Search */
        var sInput = document.getElementById('pagefind-search');
        var sDrop = document.getElementById('pagefind-dropdown');
        var sWrap = document.getElementById('header-search-wrap');
        var pagefind = null;
        var searchCache = {};
        var pagefindLoading = false;
        var activeIdx = -1;

        async function initPagefind() {
            if (pagefind || pagefindLoading) return;
            pagefindLoading = true;
            try {
                pagefind = await import('{{ get_url(path="/pagefind/pagefind.js") }}');
            } catch (e) {
                console.log('Pagefind not available');
            }
            pagefindLoading = false;
        }

        async function search(query) {
            if (!query) {
                sDrop.classList.remove('open');
                sDrop.textContent = '';
                return;
            }
            if (pagefindLoading) {
                sDrop.innerHTML = '<div class="pf-empty">Searching...</div>';
                sDrop.classList.add('open');
                return;
            }
            if (!pagefind) {
                sDrop.innerHTML = '<div class="pf-empty">No results</div>';
                sDrop.classList.add('open');
                return;
            }
            if (searchCache[query]) {
                renderResults(searchCache[query], query);
                return;
            }
            var result = await pagefind.search(query);
            var results = await Promise.all(result.results.slice(0, 5).map(function (r) { return r.data(); }));
            searchCache[query] = results;
            renderResults(results, query);
        }

        function renderResults(results, query) {
            if (results.length === 0) {
                sDrop.innerHTML = '<div class="pf-empty">No results</div>';
            } else {
                var frag = document.createDocumentFragment();
                results.forEach(function (r) {
                    var a = document.createElement('a');
                    a.className = 'pf-result';
                    a.href = r.url;
                    a.innerHTML = highlight(r.meta.title || 'Untitled', query);
                    frag.appendChild(a);
                });
                sDrop.textContent = '';
                sDrop.appendChild(frag);
            }
            sDrop.classList.add('open');
        }

        function highlight(text, query) {
            if (!query) return esc(text);
            var re = new RegExp('(' + query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'gi');
            return esc(text).replace(re, '<mark>$1</mark>');
        }

        function esc(s) {
            return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function getItems() {
            return Array.from(sDrop.querySelectorAll('.pf-result'));
        }

        function setActive(idx) {
            var items = getItems();
            items.forEach(function (el) { el.classList.remove('pf-active'); });
            if (idx >= 0 && idx < items.length) {
                items[idx].classList.add('pf-active');
                items[idx].scrollIntoView({ block: 'nearest' });
            }
            activeIdx = idx;
        }

        var debounceTimer;
        sInput.addEventListener('focus', function () {
            initPagefind();
            if (this.value.trim()) sDrop.classList.add('open');
        });

        sInput.addEventListener('input', function () {
            activeIdx = -1;
            var q = this.value.trim();
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(function () { search(q); }, 200);
        });

        sInput.addEventListener('keydown', function (e) {
            var items = getItems();
            if (!sDrop.classList.contains('open') || items.length === 0) return;
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                setActive(Math.min(activeIdx + 1, items.length - 1));
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                setActive(Math.max(activeIdx - 1, 0));
            } else if (e.key === 'Enter') {
                if (activeIdx >= 0 && items[activeIdx]) {
                    e.preventDefault();
                    window.location.href = items[activeIdx].href;
                }
            }
        });

        window.onclick = function (e) {
            if (!sWrap.contains(e.target)) sDrop.classList.remove('open');
        };

        window.onkeydown = function (e) {
            if (e.key === '/' && document.activeElement !== sInput) {
                e.preventDefault();
                sInput.focus();
            }
            if (e.key === 'Escape') {
                sDrop.classList.remove('open');
                sInput.blur();
            }
        };
    </script>

    <script>document.addEventListener('DOMContentLoaded', function () { hljs.highlightAll(); });</script>
</body>

</html>