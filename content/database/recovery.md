+++
title = "íšŒë³µ ê¸°ë²• (Recovery)"
date = 2025-03-01

[extra]
categories = "database-relational"
+++

# íšŒë³µ ê¸°ë²• (Recovery)

## í•µì‹¬ ì¸ì‚¬ì´íŠ¸ (3ì¤„ ìš”ì•½)
> **ì¥ì•  ë°œìƒ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¼ê´€ëœ ìƒíƒœë¡œ ë³µì›**í•˜ëŠ” ê¸°ë²•. ë¡œê·¸ ê¸°ë°˜ íšŒë³µ, ì²´í¬í¬ì¸íŠ¸, ARIES ì•Œê³ ë¦¬ì¦˜ ë“± ì‚¬ìš©. ACIDì˜ ì§€ì†ì„±(Durability)ì„ ë³´ì¥í•œë‹¤.

## 1. ê°œë…
íšŒë³µ ê¸°ë²•ì€ **ì‹œìŠ¤í…œ ì¥ì• , ë¯¸ë””ì–´ ì¥ì•  ë“±ì´ ë°œìƒí–ˆì„ ë•Œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¼ê´€ëœ ìƒíƒœë¡œ ë³µì›**í•˜ëŠ” ê¸°ìˆ ì´ë‹¤.

> ë¹„ìœ : "ê²Œì„ ì„¸ì´ë¸Œ" - ì¥ì• ê°€ ë‚˜ë©´ ë§ˆì§€ë§‰ ì €ì¥ì ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°

## 2. ì¥ì•  ìœ í˜•

```
1. íŠ¸ëœì­ì…˜ ì¥ì•  (Transaction Failure)
   - ë…¼ë¦¬ì  ì˜¤ë¥˜
   - ì˜ëª»ëœ ë°ì´í„°
   - ì‚¬ìš©ì ì·¨ì†Œ
   â†’ ROLLBACKìœ¼ë¡œ í•´ê²°

2. ì‹œìŠ¤í…œ ì¥ì•  (System Failure)
   - ì •ì „, í•˜ë“œì›¨ì–´ ì˜¤ë¥˜
   - ì†Œí”„íŠ¸ì›¨ì–´ ë²„ê·¸
   â†’ ì¬ì‹œì‘ í›„ REDO/UNDO

3. ë¯¸ë””ì–´ ì¥ì•  (Media Failure)
   - ë””ìŠ¤í¬ ì†ìƒ
   - í—¤ë“œ í¬ë˜ì‹œ
   â†’ ë°±ì—…ë³¸ì—ì„œ ë³µêµ¬

4. ìì—°ì¬í•´
   - í™”ì¬, í™ìˆ˜, ì§€ì§„
   â†’ ì›ê²© ë°±ì—… í•„ìš”
```

## 3. ë¡œê·¸ (Log)

### 3.1 ë¡œê·¸ ë ˆì½”ë“œ ì¢…ë¥˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ë¡œê·¸ íŒŒì¼ (Log File)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <T1, START>                                    â”‚
â”‚ <T1, A, 100, 150>    â† Aë¥¼ 100â†’150ìœ¼ë¡œ ë³€ê²½    â”‚
â”‚ <T1, B, 200, 250>    â† Bë¥¼ 200â†’250ìœ¼ë¡œ ë³€ê²½    â”‚
â”‚ <T1, COMMIT>                                   â”‚
â”‚ <T2, START>                                    â”‚
â”‚ <T2, C, 300, 350>                              â”‚
â”‚ â† ì‹œìŠ¤í…œ ì¥ì•  ë°œìƒ!                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¡œê·¸ ë ˆì½”ë“œ í˜•ì‹:
- <T, START>: íŠ¸ëœì­ì…˜ T ì‹œì‘
- <T, X, old, new>: Tê°€ Xë¥¼ oldâ†’newë¡œ ë³€ê²½
- <T, COMMIT>: íŠ¸ëœì­ì…˜ T ì»¤ë°‹
- <T, ABORT>: íŠ¸ëœì­ì…˜ T ì¤‘ë‹¨
- <CHECKPOINT>: ì²´í¬í¬ì¸íŠ¸
```

### 3.2 ë¡œê·¸ í™œìš©
```
UNDO (ë˜ëŒë¦¬ê¸°):
- ì»¤ë°‹ë˜ì§€ ì•Šì€ íŠ¸ëœì­ì…˜ ì·¨ì†Œ
- old ê°’ìœ¼ë¡œ ë³µì›
- T2ëŠ” COMMITì´ ì—†ìœ¼ë¯€ë¡œ UNDO

REDO (ë‹¤ì‹œ í•˜ê¸°):
- ì»¤ë°‹ëœ íŠ¸ëœì­ì…˜ ì¬ì‹¤í–‰
- new ê°’ìœ¼ë¡œ ì ìš©
- T1ì€ COMMITì´ ìˆìœ¼ë¯€ë¡œ REDO
```

## 4. ë¡œê·¸ ê¸°ë°˜ íšŒë³µ ê¸°ë²•

### 4.1 ì§€ì—° ê°±ì‹  (Deferred Update)
```
íŠ¹ì§•: ì»¤ë°‹ ì‹œì ê¹Œì§€ ë””ìŠ¤í¬ì— ì“°ì§€ ì•ŠìŒ

ë™ì‘:
1. íŠ¸ëœì­ì…˜ ì‹¤í–‰ ì¤‘ â†’ ë¡œê·¸ì—ë§Œ ê¸°ë¡
2. COMMIT â†’ ë¡œê·¸ë¥¼ ë””ìŠ¤í¬ì— ê¸°ë¡
3. ê·¸ í›„ ì‹¤ì œ ë°ì´í„° ê°±ì‹ 

ì¥ì :
- UNDO ë¶ˆí•„ìš” (ë””ìŠ¤í¬ì— ì•ˆ ì¼ìœ¼ë‹ˆ)
- REDOë§Œ í•„ìš”

ë‹¨ì :
- í° íŠ¸ëœì­ì…˜ì€ ë©”ëª¨ë¦¬ ë¶€ì¡± ê°€ëŠ¥
```

### 4.2 ì¦‰ì‹œ ê°±ì‹  (Immediate Update)
```
íŠ¹ì§•: ì‹¤í–‰ ì¦‰ì‹œ ë””ìŠ¤í¬ì— ë°˜ì˜ ê°€ëŠ¥

ë™ì‘:
1. ë¡œê·¸ ê¸°ë¡ (old, new ëª¨ë‘)
2. ì¦‰ì‹œ ë””ìŠ¤í¬ì— ë°˜ì˜ ê°€ëŠ¥
3. ì¥ì•  ì‹œ UNDO/REDO ëª¨ë‘ ê°€ëŠ¥

ì¥ì :
- ì‹¤ì‹œê°„ ë°˜ì˜
- ìœ ì—°ì„±

ë‹¨ì :
- UNDO í•„ìš”
- ë³µì¡í•¨
```

## 5. ì²´í¬í¬ì¸íŠ¸ (Checkpoint)

### 5.1 ê°œë…
```
ì •ê¸°ì ìœ¼ë¡œ ì‹œìŠ¤í…œ ìƒíƒœë¥¼ ë””ìŠ¤í¬ì— ì €ì¥

ì²´í¬í¬ì¸íŠ¸ ìˆ˜í–‰:
1. ì‹¤í–‰ ì¤‘ì¸ íŠ¸ëœì­ì…˜ ì¼ì‹œ ì¤‘ë‹¨
2. ë²„í¼ ë‚´ìš©ì„ ë””ìŠ¤í¬ì— ê¸°ë¡
3. <CHECKPOINT, T1, T2, ...> ë¡œê·¸ ê¸°ë¡
   (ì‹¤í–‰ ì¤‘ì¸ íŠ¸ëœì­ì…˜ ëª©ë¡)

íšŒë³µ ì‹œ:
- ì²´í¬í¬ì¸íŠ¸ ì´ì „ ë¡œê·¸ëŠ” ê²€ì‚¬ ë¶ˆí•„ìš”
- ì²´í¬í¬ì¸íŠ¸ ì´í›„ ë¡œê·¸ë§Œ ê²€ì‚¬
```

### 5.2 ì²´í¬í¬ì¸íŠ¸ ì¢…ë¥˜
```
1. ê³ ì • ì²´í¬í¬ì¸íŠ¸ (Consistent Checkpoint)
   - ëª¨ë“  íŠ¸ëœì­ì…˜ ì¤‘ë‹¨
   - ë²„í¼ í”ŒëŸ¬ì‹œ
   - ì¼ê´€ëœ ìƒíƒœ ë³´ì¥
   - ì„±ëŠ¥ ì €í•˜

2. í¼ì§€ ì²´í¬í¬ì¸íŠ¸ (Fuzzy Checkpoint)
   - íŠ¸ëœì­ì…˜ ê³„ì† ì‹¤í–‰
   - ë¹„ë™ê¸° ë²„í¼ í”ŒëŸ¬ì‹œ
   - ì„±ëŠ¥ í–¥ìƒ
   - ì‹¤ì œ DBMS ì‚¬ìš© ë°©ì‹
```

### 5.3 íšŒë³µ ê³¼ì •
```
ë¡œê·¸: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
       â†‘                    â†‘            â†‘
    ì²´í¬í¬ì¸íŠ¸            ì¥ì• ë°œìƒ      ë³µêµ¬ì‹œì‘
    (T1, T2ì‹¤í–‰ì¤‘)

ë¶„ë¥˜:
- T1: ì²´í¬í¬ì¸íŠ¸ ì „ ì‹œì‘, COMMIT ì—†ìŒ â†’ UNDO
- T2: ì²´í¬í¬ì¸íŠ¸ ì „ ì‹œì‘, COMMIT ìˆìŒ â†’ REDO
- T3: ì²´í¬í¬ì¸íŠ¸ í›„ ì‹œì‘, COMMIT ìˆìŒ â†’ REDO
- T4: ì²´í¬í¬ì¸íŠ¸ í›„ ì‹œì‘, COMMIT ì—†ìŒ â†’ UNDO
```

## 6. ARIES ì•Œê³ ë¦¬ì¦˜

```
ARIES (Algorithm for Recovery and Isolation
       Exploiting Semantics)

í˜„ëŒ€ DBMSì˜ í‘œì¤€ íšŒë³µ ì•Œê³ ë¦¬ì¦˜

3ë‹¨ê³„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Analysis (ë¶„ì„)                   â”‚
â”‚    - ë¡œê·¸ ìˆœì°¨ ìŠ¤ìº”                  â”‚
â”‚    - RedoLSN ê²°ì •                    â”‚
â”‚    - Undo ë¦¬ìŠ¤íŠ¸ êµ¬ì„±                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. Redo (ì¬ì‹¤í–‰)                     â”‚
â”‚    - RedoLSNë¶€í„° ë¡œê·¸ ìŠ¤ìº”           â”‚
â”‚    - ì»¤ë°‹ëœ ë³€ê²½ ì‚¬í•­ ì¬ì ìš©         â”‚
â”‚    - ë°ì´í„° ì¼ê´€ì„± ë³µì›              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. Undo (ì·¨ì†Œ)                       â”‚
â”‚    - ë¯¸ì™„ë£Œ íŠ¸ëœì­ì…˜ ì·¨ì†Œ            â”‚
â”‚    - ì—­ìˆœìœ¼ë¡œ ë¡œê·¸ ì²˜ë¦¬              â”‚
â”‚    - CLR (Compensation Log Record)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í•µì‹¬ ì›ì¹™:
- WAL (Write-Ahead Logging): ë°ì´í„°ë³´ë‹¤ ë¡œê·¸ ë¨¼ì €
- Repeating History: Redoë¡œ ì •í™•í•œ ìƒíƒœ ë³µì›
- Logging Undos: Undo ì‘ì—…ë„ ë¡œê¹…
```

## 7. ë°±ì—… ì „ëµ

### 7.1 ë°±ì—… ì¢…ë¥˜
```
1. ì „ì²´ ë°±ì—… (Full Backup)
   - ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ ë³µì‚¬
   - ì‹œê°„ ì˜¤ë˜ ê±¸ë¦¼
   - ë³µêµ¬ ê°„ë‹¨

2. ì°¨ë“± ë°±ì—… (Differential Backup)
   - ë§ˆì§€ë§‰ ì „ì²´ ë°±ì—… ì´í›„ ë³€ê²½ë¶„
   - ì „ì²´ ë°±ì—…ë³´ë‹¤ ë¹ ë¦„

3. ì¦ë¶„ ë°±ì—… (Incremental Backup)
   - ë§ˆì§€ë§‰ ë°±ì—… ì´í›„ ë³€ê²½ë¶„
   - ê°€ì¥ ë¹ ë¦„
   - ë³µêµ¬ ë³µì¡

4. ë¡œê·¸ ë°±ì—… (Log Backup)
   - íŠ¸ëœì­ì…˜ ë¡œê·¸ ë°±ì—…
   - íŠ¹ì • ì‹œì  ë³µêµ¬ ê°€ëŠ¥
```

### 7.2 ë°±ì—… ì „ëµ
```
ì¼ë°˜ì  ì „ëµ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì¼ìš”ì¼: ì „ì²´ ë°±ì—…                    â”‚
â”‚ ì›”~í† : ì¦ë¶„ ë°±ì—…                     â”‚
â”‚ ë§¤ì‹œê°„: ë¡œê·¸ ë°±ì—…                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤:
1. ì¼ìš”ì¼ ì „ì²´ ë°±ì—… ë³µì›
2. ì›”~ê¸ˆ ì¦ë¶„ ë°±ì—… ìˆœì°¨ ì ìš©
3. ë¡œê·¸ ë°±ì—…ìœ¼ë¡œ íŠ¹ì • ì‹œì  ë³µêµ¬
```

## 8. ë°ì´í„°ë² ì´ìŠ¤ ë³µì œ

### 8.1 ë³µì œ ë°©ì‹
```
ë™ê¸°ì‹ ë³µì œ (Synchronous):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    COMMIT    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì£¼ DB  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  ë¶€ DB  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†â”€â”€â”€ ACK â”€â”€â”€ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
- ë°ì´í„° ì†ì‹¤ ì—†ìŒ
- ì„±ëŠ¥ ì €í•˜

ë¹„ë™ê¸°ì‹ ë³µì œ (Asynchronous):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    COMMIT    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì£¼ DB  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  ë¶€ DB  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        (ë‚˜ì¤‘ì— ë³µì œ)
- ì„±ëŠ¥ í–¥ìƒ
- ì¼ë¶€ ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥
```

### 8.2 ê³ ê°€ìš©ì„± êµ¬ì„±
```
Active-Standby:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Active â”‚ â† ì„œë¹„ìŠ¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Standby â”‚ â† ëŒ€ê¸°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Active-Active:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Active â”‚ â† ì„œë¹„ìŠ¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Active â”‚ â† ì„œë¹„ìŠ¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 9. ì½”ë“œ ì˜ˆì‹œ

```python
from enum import Enum
from dataclasses import dataclass
from typing import List, Dict, Optional
import time

class LogType(Enum):
    START = "START"
    UPDATE = "UPDATE"
    COMMIT = "COMMIT"
    ABORT = "ABORT"
    CHECKPOINT = "CHECKPOINT"

@dataclass
class LogRecord:
    """ë¡œê·¸ ë ˆì½”ë“œ"""
    lsn: int              # Log Sequence Number
    tx_id: str            # íŠ¸ëœì­ì…˜ ID
    log_type: LogType     # ë¡œê·¸ íƒ€ì…
    data_item: Optional[str] = None  # ë°ì´í„° í•­ëª©
    old_value: Optional[int] = None  # ì´ì „ ê°’
    new_value: Optional[int] = None  # ìƒˆ ê°’

class LogManager:
    """ë¡œê·¸ ê´€ë¦¬ì"""

    def __init__(self):
        self.logs: List[LogRecord] = []
        self.current_lsn = 0

    def write_log(self, tx_id: str, log_type: LogType,
                  data_item=None, old_value=None, new_value=None) -> int:
        """ë¡œê·¸ ê¸°ë¡"""
        self.current_lsn += 1
        record = LogRecord(
            lsn=self.current_lsn,
            tx_id=tx_id,
            log_type=log_type,
            data_item=data_item,
            old_value=old_value,
            new_value=new_value
        )
        self.logs.append(record)
        return self.current_lsn

    def get_logs_after(self, lsn: int) -> List[LogRecord]:
        """íŠ¹ì • LSN ì´í›„ ë¡œê·¸ ì¡°íšŒ"""
        return [log for log in self.logs if log.lsn > lsn]


class RecoveryManager:
    """íšŒë³µ ê´€ë¦¬ì"""

    def __init__(self, log_manager: LogManager):
        self.log_manager = log_manager

    def analyze(self, checkpoint_lsn: int = 0) -> Dict:
        """ë¶„ì„ ë‹¨ê³„"""
        redo_txs = set()  # REDO í•„ìš”í•œ íŠ¸ëœì­ì…˜
        undo_txs = set()  # UNDO í•„ìš”í•œ íŠ¸ëœì­ì…˜

        logs = self.log_manager.get_logs_after(checkpoint_lsn)

        for log in logs:
            if log.log_type == LogType.START:
                undo_txs.add(log.tx_id)
            elif log.log_type == LogType.COMMIT:
                undo_txs.discard(log.tx_id)
                redo_txs.add(log.tx_id)
            elif log.log_type == LogType.ABORT:
                undo_txs.discard(log.tx_id)

        return {
            'redo_txs': redo_txs,
            'undo_txs': undo_txs
        }

    def redo(self, database: Dict, redo_txs: set, checkpoint_lsn: int = 0):
        """REDO ë‹¨ê³„"""
        logs = self.log_manager.get_logs_after(checkpoint_lsn)

        for log in logs:
            if log.tx_id in redo_txs and log.log_type == LogType.UPDATE:
                database[log.data_item] = log.new_value
                print(f"REDO: {log.data_item} = {log.new_value}")

    def undo(self, database: Dict, undo_txs: set):
        """UNDO ë‹¨ê³„"""
        # ì—­ìˆœìœ¼ë¡œ ë¡œê·¸ ì²˜ë¦¬
        for log in reversed(self.log_manager.logs):
            if log.tx_id in undo_txs and log.log_type == LogType.UPDATE:
                database[log.data_item] = log.old_value
                print(f"UNDO: {log.data_item} = {log.old_value}")

    def recover(self, database: Dict, checkpoint_lsn: int = 0):
        """ì „ì²´ íšŒë³µ ìˆ˜í–‰"""
        print("=== íšŒë³µ ì‹œì‘ ===")

        # 1. ë¶„ì„
        analysis = self.analyze(checkpoint_lsn)
        print(f"REDO í•„ìš”: {analysis['redo_txs']}")
        print(f"UNDO í•„ìš”: {analysis['undo_txs']}")

        # 2. REDO
        print("\n--- REDO ë‹¨ê³„ ---")
        self.redo(database, analysis['redo_txs'], checkpoint_lsn)

        # 3. UNDO
        print("\n--- UNDO ë‹¨ê³„ ---")
        self.undo(database, analysis['undo_txs'])

        print("\n=== íšŒë³µ ì™„ë£Œ ===")


class Database:
    """ê°„ë‹¨í•œ ë°ì´í„°ë² ì´ìŠ¤ ì‹œë®¬ë ˆì´ì…˜"""

    def __init__(self):
        self.data: Dict[str, int] = {}
        self.log_manager = LogManager()
        self.recovery_manager = RecoveryManager(self.log_manager)

    def begin_transaction(self, tx_id: str):
        """íŠ¸ëœì­ì…˜ ì‹œì‘"""
        self.log_manager.write_log(tx_id, LogType.START)

    def update(self, tx_id: str, key: str, new_value: int):
        """ë°ì´í„° ê°±ì‹ """
        old_value = self.data.get(key, 0)
        self.log_manager.write_log(tx_id, LogType.UPDATE, key, old_value, new_value)
        self.data[key] = new_value

    def commit(self, tx_id: str):
        """ì»¤ë°‹"""
        self.log_manager.write_log(tx_id, LogType.COMMIT)

    def abort(self, tx_id: str):
        """ì¤‘ë‹¨"""
        self.log_manager.write_log(tx_id, LogType.ABORT)

    def checkpoint(self, active_txs: List[str]):
        """ì²´í¬í¬ì¸íŠ¸"""
        self.log_manager.write_log("SYSTEM", LogType.CHECKPOINT)

    def crash_recovery(self, checkpoint_lsn: int = 0):
        """ì¥ì•  ë³µêµ¬"""
        self.recovery_manager.recover(self.data, checkpoint_lsn)


# ì‚¬ìš© ì˜ˆì‹œ
db = Database()

print("=== ì •ìƒ íŠ¸ëœì­ì…˜ ì‹¤í–‰ ===")
db.begin_transaction("T1")
db.update("T1", "A", 100)
db.update("T1", "B", 200)
db.commit("T1")
print(f"ë°ì´í„°: {db.data}")

print("\n=== ì¥ì•  ë°œìƒ ì‹œë®¬ë ˆì´ì…˜ ===")
db.begin_transaction("T2")
db.update("T2", "A", 150)  # ì»¤ë°‹ ì•ˆ í•¨
db.begin_transaction("T3")
db.update("T3", "C", 300)
db.commit("T3")
# ì¥ì•  ë°œìƒ! T2ëŠ” ì»¤ë°‹ ì•ˆ ë¨

print(f"ì¥ì•  ì „ ë°ì´í„°: {db.data}")
print("\n=== ì¥ì•  í›„ ë³µêµ¬ ===")
db.crash_recovery()
print(f"ë³µêµ¬ í›„ ë°ì´í„°: {db.data}")
```

## 10. ì¥ë‹¨ì 

### íšŒë³µ ê¸°ë²•ì˜ ì¥ì 
| ì¥ì  | ì„¤ëª… |
|-----|------|
| ë°ì´í„° ë³´í˜¸ | ì¥ì•  ì‹œ ë°ì´í„° ì†ì‹¤ ë°©ì§€ |
| ë¬´ê²°ì„± ìœ ì§€ | ì¼ê´€ëœ ìƒíƒœ ë³µì› |
| ê°€ìš©ì„± | ë¹ ë¥¸ ì„œë¹„ìŠ¤ ì¬ê°œ |

### íšŒë³µ ê¸°ë²•ì˜ ë‹¨ì 
| ë‹¨ì  | ì„¤ëª… |
|-----|------|
| ì˜¤ë²„í—¤ë“œ | ë¡œê·¸ ê¸°ë¡ ë¹„ìš© |
| ì €ì¥ ê³µê°„ | ë¡œê·¸ íŒŒì¼ í¬ê¸° |
| ë³µêµ¬ ì‹œê°„ | ëŒ€ìš©ëŸ‰ DBëŠ” ë³µêµ¬ ì˜¤ë˜ ê±¸ë¦¼ |

## 11. ì‹¤ë¬´ì—ì„ ? (ê¸°ìˆ ì‚¬ì  íŒë‹¨)
- **ë¡œê·¸ íŒŒì¼**: ë³„ë„ ë””ìŠ¤í¬ì— ì €ì¥ (I/O ë¶„ì‚°)
- **ì²´í¬í¬ì¸íŠ¸**: 5-10ë¶„ ê°„ê²© ê¶Œì¥
- **ë°±ì—… ì „ëµ**: RPO/RTO ê¸°ì¤€ ìˆ˜ë¦½
- **HA êµ¬ì„±**: Active-Standby ê¸°ë³¸, ì¤‘ìš” ì„œë¹„ìŠ¤ Active-Active
- **ëª¨ë‹ˆí„°ë§**: ë¡œê·¸ íŒŒì¼ í¬ê¸°, ì²´í¬í¬ì¸íŠ¸ ë¹ˆë„ ëª¨ë‹ˆí„°ë§
- **í…ŒìŠ¤íŠ¸**: ì •ê¸°ì  ë³µêµ¬ í›ˆë ¨ í•„ìˆ˜

## 12. ê´€ë ¨ ê°œë…
- ACID
- WAL (Write-Ahead Logging)
- íŠ¸ëœì­ì…˜
- ì²´í¬í¬ì¸íŠ¸
- ê³ ê°€ìš©ì„± (HA)

---

## ì–´ë¦°ì´ë¥¼ ìœ„í•œ ì¢…í•© ì„¤ëª…

**íšŒë³µ ê¸°ë²•ì€ "ê²Œì„ ì„¸ì´ë¸Œ" ê°™ì•„ìš”!**

### ì™œ í•„ìš”í• ê¹Œ? ğŸ®
```
ê²Œì„ ì¤‘ ì „ì›ì´ ë‚˜ê°”ì–´ìš”! ğŸ˜±

ì„¸ì´ë¸Œ ì—†ì´:
- ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•´ì•¼ í•´ìš” ğŸ˜­

ì„¸ì´ë¸Œ ìˆìœ¼ë©´:
- ë§ˆì§€ë§‰ ì €ì¥ì ë¶€í„° ê³„ì†! ğŸ˜Š
```

### ë¡œê·¸ë€? ğŸ“
```
ëª¨ë“  í–‰ë™ì„ ì ì–´ë‘ëŠ” ì¼ê¸°ì¥

[T1 ì‹œì‘]
[T1] Aë¥¼ 100â†’150ìœ¼ë¡œ ë³€ê²½
[T1] Bë¥¼ 200â†’250ìœ¼ë¡œ ë³€ê²½
[T1 ì»¤ë°‹] â† ì„±ê³µ!

[T2 ì‹œì‘]
[T2] Cë¥¼ 300â†’350ìœ¼ë¡œ ë³€ê²½
â† ì¥ì•  ë°œìƒ! (ì»¤ë°‹ ì—†ìŒ)
```

### íšŒë³µ ë°©ë²• ğŸ”„
```
REDO (ë‹¤ì‹œ í•˜ê¸°):
- ì»¤ë°‹í•œ ê±´ ë‹¤ì‹œ ì ìš©
- T1ì€ ì„±ê³µí–ˆìœ¼ë‹ˆ ê²°ê³¼ ìœ ì§€

UNDO (ë˜ëŒë¦¬ê¸°):
- ì»¤ë°‹ ì•ˆ í•œ ê±´ ì·¨ì†Œ
- T2ëŠ” ì‹¤íŒ¨í–ˆìœ¼ë‹ˆ ì—†ë˜ ê±¸ë¡œ
```

### ì²´í¬í¬ì¸íŠ¸ ğŸ“
```
ì •ê¸°ì ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ì„¸ì´ë¸Œ í¬ì¸íŠ¸

íšŒë³µ ì‹œ ì²´í¬í¬ì¸íŠ¸ë¶€í„°ë§Œ í™•ì¸í•˜ë©´ ë¨!
â†’ ë¹ ë¥¸ ë³µêµ¬ ê°€ëŠ¥
```

**ë¹„ë°€**: ì€í–‰, ë³‘ì›, í•­ê³µì‚¬ ëª¨ë‘ íšŒë³µ ê¸°ë²•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì§€ì¼œìš”! ğŸ¥âœˆï¸âœ¨
