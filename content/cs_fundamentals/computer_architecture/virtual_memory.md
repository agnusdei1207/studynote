# 가상 메모리 (Virtual Memory)

## 핵심 인사이트 (3줄 요약)
> 물리 메모리보다 **큰 주소 공간을 제공**하는 메모리 관리 기술. 페이지 단위로 디스크를 메모리처럼 사용한다. MMU와 페이지 테이블로 가상-물리 주소 변환을 수행한다.

## 1. 개념
가상 메모리(Virtual Memory)는 **물리 메모리(RAM)와 디스크를 결합**하여 더 큰 메모리 공간처럼 보이게 하는 기술이다. 프로그램은 연속된 주소 공간을 사용하는 것처럼 보인다.

> 비유: "책상 + 책장" - 책상이 꽉 차면 책장으로 옮김

## 2. 가상 주소 공간

```
가상 주소 공간 (프로그램 입장):
┌─────────────────┐ 0xFFFFFFFF
│    커널 영역    │
├─────────────────┤
│    스택 ↓       │
│        ...      │
│    힙 ↑        │
├─────────────────┤
│    BSS          │
├─────────────────┤
│    데이터       │
├─────────────────┤
│    코드         │
└─────────────────┘ 0x00000000

각 프로세스는 독립된 가상 주소 공간 보유
```

## 3. 페이지와 프레임

```
가상 메모리: 페이지 (Page) 단위
물리 메모리: 프레임 (Frame) 단위

┌─────┐         ┌─────┐
│ P0  │ ───────→│ F3  │
├─────┤         ├─────┤
│ P1  │ ──✗     │ F0  │
├─────┤         ├─────┤
│ P2  │ ───────→│ F1  │
├─────┤         ├─────┤
│ P3  │ ──디스크│ F2  │
└─────┘         └─────┘
가상            물리

P1, P3은 디스크에 있음 (Page Fault 시 로드)
```

## 4. 주소 변환

```
가상 주소: [페이지 번호][오프셋]
           └── 20비트 ──┘└12비트┘

페이지 테이블 조회:
가상 페이지 번호 → 물리 프레임 번호

물리 주소: [프레임 번호][오프셋]
           └── 20비트 ──┘└12비트┘

오프셋은 그대로 사용!
```

## 5. 페이지 테이블

```
페이지 테이블 엔트리:
┌─────────────────────────────┐
│ 프레임 번호 | V | D | R | X │
└─────────────────────────────┘

V (Valid): 메모리에 있음
D (Dirty): 수정됨
R (Referenced): 접근됨
X (Executable): 실행 가능
```

## 6. 페이지 폴트

```
페이지 폴트 처리 과정:

1. 페이지 테이블에서 V=0 확인
2. OS에 페이지 폴트 인터럽트
3. 디스크에서 페이지 로드
4. 페이지 테이블 갱신
5. 명령어 재실행

→ 큰 오버헤드!
```

## 7. TLB (Translation Lookaside Buffer)

```
TLB: 페이지 테이블 캐시

가상 주소 → TLB 조회
  ↓ Hit     ↓ Miss
물리 주소   페이지 테이블 조회

TLB Hit Rate가 성능 결정
일반적 Hit Rate: 95%+
```

## 8. 페이지 교체 알고리즘

| 알고리즘 | 설명 | 특징 |
|----------|------|------|
| FIFO | 먼저 들어온 것 교체 | 간단, Belady's Anomaly |
| LRU | 가장 오래 안 쓴 것 | 효율, 구현 복잡 |
| Clock | LRU 근사 | 효율, 간단 |
| Optimal | 미래 기반 | 이론적 최적 |

## 9. 장단점

| 장점 | 단점 |
|-----|------|
| 큰 메모리 공간 | 페이지 폴트 오버헤드 |
| 메모리 보호 | TLB 미스 비용 |
| 프로세스 격리 | 복잡한 구현 |

## 10. 실무에선? (기술사적 판단)
- **페이지 크기**: 4KB (기본) ~ 2MB (Huge Pages)
- **성능**: TLB 커버리지가 핵심
- **데이터베이스**: Huge Pages 사용 권장
- **컨테이너**: 메모리 제한 설정 중요

## 11. 관련 개념
- MMU (Memory Management Unit)
- TLB
- 스와핑

---

## 어린이를 위한 종합 설명

**가상 메모리는 "마법 책상"이야!**

작은 책상(RAM)으로 큰 책장(SSD)까지 쓸 수 있어요!

### 비유
```
책상(RAM): 10권만 놓을 수 있어요
책장(SSD): 1000권 보관할 수 있어요

책상이 꽉 차면:
1. 안 보는 책을 책장으로 옮겨요
2. 필요한 책을 책장에서 꺼내요
→ 1000권을 다 읽을 수 있어요!
```

### 페이지 = 책 한 권
```
책상: [책1][책2][책3]... (프레임)
책장: [책4][책5][책6]... (페이지)

필요한 책이 책상에 없으면?
→ 책장에서 찾아서 책상으로! (Page Fault)
```

### TLB = 책 목록
```
"어떤 책이 어디 있나?"를 빨리 찾는 메모장!

TLB Hit: 목록에 있어요! ✅
TLB Miss: 목록에 없어요... 😢
```

**비밀**: 여러 프로그램을 동시에 실행할 수 있는 이유가 가상 메모리 덕분이에요! 각 프로그램은 자기만의 책상을 가진 것처럼 느껴요! 📚
