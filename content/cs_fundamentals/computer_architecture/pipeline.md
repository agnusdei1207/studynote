+++
title = "파이프라이닝 (Pipelining)"
date = 2025-02-27
+++

# 파이프라이닝 (Pipelining)

## 핵심 인사이트 (3줄 요약)
> 명령어 실행을 **여러 단계로 나누어 병렬 처리**하는 기법. 한 클럭에 한 명령어가 완료되는 효과를 얻는다. 데이터 해저드, 제어 해저드 등의 문제를 해결해야 한다.

## 1. 개념
파이프라이닝(Pipelining)은 **명령어 실행 과정을 여러 단계로 분리**하여, 각 단계가 병렬로 처리되도록 하는 기법이다.

> 비유: "세탁소 컨베이어" - 여러 단계가 동시에 진행

## 2. 비파이프라인 vs 파이프라인

```
비파이프라인 (순차 실행):
명령어 1: [IF][ID][EX][MEM][WB]
명령어 2:                    [IF][ID][EX][MEM][WB]
명령어 3:                                       [IF]...

→ 5클럭에 1개 명령어 완료

파이프라인:
명령어 1: [IF][ID][EX][MEM][WB]
명령어 2:    [IF][ID][EX][MEM][WB]
명령어 3:       [IF][ID][EX][MEM][WB]
명령어 4:          [IF][ID][EX][MEM][WB]
명령어 5:             [IF][ID][EX][MEM][WB]

→ 1클럭에 1개 명령어 완료!
```

## 3. 5단계 파이프라인 (MIPS)

| 단계 | 이름 | 역할 |
|------|------|------|
| IF | Instruction Fetch | 명령어 인출 |
| ID | Instruction Decode | 명령어 해석 |
| EX | Execute | 연산 수행 |
| MEM | Memory Access | 메모리 접근 |
| WB | Write Back | 결과 저장 |

## 4. 파이프라인 성능

```
처리량 (Throughput):
- 이상적: 1 CPI (Cycle Per Instruction)
- 실제: 1~2 CPI

속도 향상:
Speedup = 파이프라인 단계 수 (이상적)

예: 5단계 파이프라인 → 최대 5배 향상
```

## 5. 파이프라인 해저드

### 데이터 해저드 (Data Hazard)
```
ADD R1, R2, R3   ; R1 = R2 + R3
SUB R4, R1, R5   ; R4 = R1 - R5 ← R1이 아직 안 끝남!

해결:
1. 포워딩 (Forwarding): 결과를 바로 전달
2. 스톨 (Stall): 대기
3. 코드 재배치: 순서 변경
```

### 제어 해저드 (Control Hazard)
```
BEQ R1, R2, label  ; 분기 명령어
ADD R3, R4, R5     ; 분기될지 모르고 미리 실행?

해결:
1. 분기 예측 (Branch Prediction)
2. 지연 슬롯 (Delay Slot)
3. 스톨
```

### 구조 해저드 (Structural Hazard)
```
같은 자원을 동시에 사용하려 할 때

해결:
- 자원 복제 (하버드 구조)
- 버스트 모드
```

## 6. 포워딩 (Forwarding)

```
해저드 상황:
  ADD R1, R2, R3    [IF][ID][EX][MEM][WB]
  SUB R4, R1, R5        [IF][ID][EX ][MEM][WB]
                                  ↑ R1 필요

포워딩 없이: EX 단계까지 기다림 → 스톨
포워딩: EX 결과를 바로 다음 EX로 전달
```

## 7. 분기 예측

```
정적 예측:
- 항상 분기 안 함
- 항상 분기함
- 뒤로 분기면 루프 → 분기함

동적 예측:
- 과거 이력 기반 (BHT: Branch History Table)
- 90% 이상 정확도
```

## 8. 슈퍼파이프라인 vs 슈퍼스칼라

| 특징 | 슈퍼파이프라인 | 슈퍼스칼라 |
|------|---------------|-----------|
| 단계 수 | 많음 (10+) | 보통 |
| 클럭 | 높음 | 보통 |
| 병렬 명령어 | 1개 | 여러 개 |
| 복잡도 | 높음 | 매우 높음 |

## 9. 장단점

| 장점 | 단점 |
|-----|------|
| 처리량 향상 | 해저드 처리 복잡 |
| 하드웨어 효율 | 분기 비용 |
| 높은 클럭 가능 | 파이프라인 플러시 비용 |

## 10. 실무에선? (기술사적 판단)
- **현대 CPU**: 15~20단계 이상 파이프라인
- **GPU**: 수천 개의 파이프라인 병렬
- **분기 예측**: 95%+ 정확도 달성
- **AI**: 파이프라인 최적화가 성능 핵심

## 11. 관련 개념
- 해저드 (Hazard)
- 슈퍼스칼라
- 분기 예측

---

## 어린이를 위한 종합 설명

**파이프라이닝은 "피자 가게 컨베이어"야!**

### 예전 방식 (비파이프라인)
```
피자 1개: 도우 → 소스 → 토핑 → 굽기 → 포장
                 (완료까지 기다림)
피자 2개:                              도우 → ...
```
→ 5분에 1개씩밖에 못 만들어요! 😢

### 파이프라인 방식
```
도우:   피자1  피자2  피자3  피자4
소스:         피자1  피자2  피자3
토핑:              피자1  피자2
굽기:                  피자1
포장:                      피자1
```
→ 1분에 1개씩 완성! 🍕

**문제점 (해저드)**:
1. **데이터**: "치즈 다 썼어요!" → 재료 전달 (포워딩)
2. **제어**: "오늘은 쉬는 날인가?" → 영업 여부 예측
3. **구조**: "오븐이 하나예요!" → 오븐 추가

**비밀**: 요즘 CPU는 20단계 컨베이어로 엄청 빨라요! 🏃💨
