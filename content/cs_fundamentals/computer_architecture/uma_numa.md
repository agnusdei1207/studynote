# UMA / NUMA (메모리 접근 아키텍처)

## 핵심 인사이트 (3줄 요약)
> 멀티프로세서 시스템에서 **메모리 접근 방식**을 정의한다. UMA는 모든 CPU가 동일한 시간에 메모리 접근, NUMA는 CPU마다 로컬 메모리가 있어 접근 시간이 다르다. 대규모 서버는 NUMA를 사용한다.

## 1. 개념
- **UMA (Uniform Memory Access)**: 모든 CPU가 메모리에 **동일한 지연 시간**으로 접근
- **NUMA (Non-Uniform Memory Access)**: CPU마다 **로컬 메모리**가 있어 접근 시간이 다름

## 2. UMA 구조

```
┌─────────────────────────────────┐
│           공유 메모리            │
└────────────┬────────────────────┘
             │ 버스
    ┌────────┼────────┬────────┐
    │        │        │        │
┌───┴───┐┌───┴───┐┌───┴───┐┌───┴───┐
│ CPU 0 ││ CPU 1 ││ CPU 2 ││ CPU 3 │
└───────┘└───────┘└───────┘└───────┘

특징: 모든 CPU가 같은 시간에 메모리 접근
```

## 3. NUMA 구조

```
┌──────────┐     ┌──────────┐
│  CPU 0   │     │  CPU 1   │
│  로컬    │     │  로컬    │
│  메모리  │     │  메모리  │
└────┬─────┘     └────┬─────┘
     │  인터커넥트     │
     └────────┬────────┘
              │
        ┌─────┴─────┐
        │  원격      │
        │  접근      │
        └───────────┘

특징: 로컬 메모리 접근은 빠름, 원격은 느림
```

## 4. 접근 시간 비교

| 아키텍처 | 로컬 접근 | 원격 접근 |
|----------|----------|----------|
| UMA | 100ns | 100ns |
| NUMA | 80ns | 150ns |

## 5. 장단점 비교

### UMA
| 장점 | 단점 |
|-----|------|
| 프로그래밍 쉬움 | 확장성 제한 |
| 예측 가능한 성능 | 버스 병목 |

### NUMA
| 장점 | 단점 |
|-----|------|
| 확장성 좋음 | 프로그래밍 복잡 |
| 대역폭 높음 | 데이터 배치 중요 |

## 6. NUMA 최적화 전략

```
1. 메모리 친화도 (Memory Affinity)
   - 데이터를 사용하는 CPU 근처에 배치

2. 스레드 마이그레이션 방지
   - 스레드를 같은 NUMA 노드에 유지

3. 페이지 마이그레이션
   - 자주 접근하는 페이지를 로컬로 이동

Linux 명령:
$ numactl --cpunodebind=0 --membind=0 ./program
```

## 7. NUMA 노드 확인 (Linux)

```bash
# NUMA 노드 정보
$ numactl --hardware

# 프로세스 NUMA 통계
$ numastat -p <pid>
```

## 8. 활용 분야

| 분야 | 권장 아키텍처 |
|------|--------------|
| 소규모 서버 | UMA |
| 대규모 서버 | NUMA |
| HPC | NUMA |
| 데이터베이스 | NUMA |

## 9. 실무에선? (기술사적 판단)
- **소켓 1개**: UMA (일반 PC)
- **소켓 2개 이상**: NUMA (서버)
- **데이터베이스**: NUMA 인식 설정 필수
- **VM**: NUMA 노드 경계 고려

## 10. 관련 개념
- SMP (Symmetric Multiprocessing)
- ccNUMA (Cache-coherent NUMA)
- 인터커넥트

---

## 어린이를 위한 종합 설명

**UMA vs NUMA는 "사무실 배치"야!**

### UMA (통일 사무실)
```
┌─────────────────────────────┐
│       📁 파일실 (메모리)     │
│  ┌───┐ ┌───┐ ┌───┐ ┌───┐  │
│  │사원│ │사원│ │사원│ │사원│  │
│  └───┘ └───┘ └───┘ └───┘  │
└─────────────────────────────┘

모든 사원이 파일실까지 같은 거리! 🚶
```

### NUMA (분산 사무실)
```
┌───────────┐    ┌───────────┐
│ 📁 파일실A│    │ 📁 파일실B│
│ ┌───┐┌───┐│    │┌───┐┌───┐│
│ │사원││사원││    ││사원││사원││
│ └───┘└───┘│    │└───┘└───┘│
│   A팀     │───→│   B팀     │
└───────────┘    └───────────┘

A팀은 A파일실이 가까워요! 🏃
B팀 파일은 좀 멀어요 🚶🚶
```

**비밀**: 큰 서버는 NUMA를 써요! A팀은 A파일, B팀은 B파일 쓰게 하면 빠르니까요! 📂
